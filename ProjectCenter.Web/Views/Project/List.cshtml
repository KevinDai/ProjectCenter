@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    IEnumerable<ItemSelectViewModel> users = ViewBag.Users;
    UserInfo currentUser = ViewBag.UserInfo;
}
<div class="row">
    <div class="col-md-12">
        <div class="system-toolbar affix">
            <div class="container">
                <div class="row">
                    <div class="col-md-3">
                        <div class="btn-group">
                            <button data-bind="click: add" class="btn btn-danger btn-new">
                                发布任务</button>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div id="listToolbar" class="row">
                            <div class="col-md-6">
                                <ul class="list-inline">
                                    <li>
                                        @if (ViewBag.UserInfo.RightDetail.EnableCheckProject)
                                        {
                                            <div class="btn-group">
                                                <a href="#" class="btn btn-default dropdown-toggle btn-action" data-toggle="dropdown">
                                                    <input data-bind="checked: AllChecked, click: function(){ return true; }, clickBubble: false" type="checkbox">
                                                    <span class="caret caret-righ"></span></a>
                                                <ul class="dropdown-menu">
                                                    <li><a data-bind="click: changeItemsChecked.bind($data, true)" href="#">全选</a></li>
                                                    <li><a data-bind="click: changeItemsChecked.bind($data, false)" href="#">全不选</a></li>
                                                </ul>
                                            </div>@*

                                            <div data-bind="visible: AnyItemSelected" class="btn-group item-action">
                                                <a class="btn btn-default btn-action" data-toggle="tooltip" data-placement="bottom"
                                                    title="删除"><span class="glyphicon glyphicon-trash"></span></a>
                                            </div>*@
                                            <div data-bind="visible: anyItemSelected" class="btn-group item-action">
                                                <a class="btn btn-default dropdown-toggle btn-action" data-toggle="dropdown"><span
                                                    class="glyphicon glyphicon-tags"></span><span class="caret caret-right"></span>
                                                </a>
                                                <ul class="dropdown-menu">
                                                    <li><a data-bind="click: check.bind($data, 1)" href="#">标记为发布已审核</a></li>
                                                    <li><a data-bind="click: check.bind($data, 3)" href="#">标记为完成已审核</a></li>
                                                    <li><a data-bind="click: check.bind($data, 4)" href="#">标记为已取消</a></li>
                                                </ul>
                                            </div>
                                        }

                                        <a data-bind="visible: pageList.Total() > 0" class="btn btn-default btn-action" data-toggle="tooltip" data-placement="bottom"
                                            title="下载"><span class="glyphicon glyphicon-download-alt"></span></a></li>
                                </ul>
                            </div>
                            <div data-bind="with: pageList" class="col-md-6">
                                @{Html.RenderPartial("PaginationPartialView");}
                            </div>
                        </div>
                        <div id="editToolbar" class="row" style="display: none">
                            <div class="col-md-6">
                                <ul class="list-inline">
                                    <li>
                                        <a data-bind="click: back" data-toggle="tooltip" data-placement="bottom"
                                            class="btn btn-default btn-action" title="返回"><span class="glyphicon glyphicon-arrow-left"></span></a>
                                        <a data-bind="click: save" data-toggle="tooltip" data-placement="bottom" class="btn btn-default btn-action" title="保存">
                                            <span class="glyphicon glyphicon-ok"></span>

                                        </a>
                                        <div data-bind="visible: projectEdit.EnableSetCompleteCheck" class="btn-group item-action">
                                            <a data-bind="click: projectEdit.sendFinishCheck" data-toggle="tooltip" data-placement="bottom" class="btn btn-default btn-action" title="标记为完成待审">
                                                <span class="glyphicon glyphicon-tags"></span>
                                            </a>
                                        </div>
                                        @*                                        <a class="btn btn-default btn-action"
                                            data-toggle="tooltip" data-placement="bottom" title="删除"><span class="glyphicon glyphicon-trash"></span></a>*@
                                        @*<div class="btn-group item-action">
                                            <a class="btn dropdown-toggle btn-action" data-toggle="dropdown" title="标记"><i class="glyphicon glyphicon-tags">
                                            </i><span class="caret"></span></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="#"><i class="icon-ok"></i>标记为完成</a></li>
                                                <li><a href="#"><i class="icon-off"></i>标记为取消</a></li>
                                            </ul>
                                        </div>*@ </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="toolbar-hr">
                @*             <div class="row">
                    <div class="col-md-10">
                        <form class="form-horizontal" role="form">
                            <div class="form-group">
                                <label class="col-md-2 control-label">项目名称</label>
                                <div class="col-md-6">
                                    <input type="email" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">
                                    截止时间</label>
                                <div class="col-md-4">
                                    <div class="input-group date form_datetime">
                                        <input data-bind="value: Deadline" class="form-control required" type="text" value="">
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-remove"></span>
                                        </span>
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                                <label class="col-md-1 control-label">至</label>
                                <div class="col-md-4">
                                    <div class="input-group date form_datetime">
                                        <input data-bind="value: Deadline" class="form-control required" type="text" value="">
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-remove"></span>
                                        </span>
                                        <span class="input-group-addon">
                                            <span class="glyphicon glyphicon-calendar"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group pull-right">
                            <button class="btn btn-default btn-action btn-primary">查询</button>
                        </div>
                    </div>
                </div>
                <hr class="toolbar-hr">*@
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 system-content">
                <div class="row">
                    <div class="col-md-3">
                        <div class="system-sidebar">
                            <ul class="nav system-sidenav">
                                <!-- ko foreach: { data: filterLinks, as: 'filterLink' } -->
                                <li class="nav-header"><span data-bind="text: name"></span></li>
                                <li data-bind="if: value"><a data-bind="click: clear" href="javascript:void(0);"><span
                                    class="text-all"><span class="glyphicon glyphicon-minus glyphicon-all"></span>全部</span></a></li>
                                <li>
                                    <ul data-bind="foreach: { data: selectListItems, as: 'item' }" class="nav nav-list">
                                        <li data-bind="attr: { 'class': filterLink.value() == item.value ? 'active' : ''}"><a
                                            data-bind="text: item.name, click: filterLink.select" class="" href="#"></a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <hr>
                                </li>
                                <!-- /ko -->
                            </ul>
                        </div>
                    </div>
                    <div id="list" class="col-md-9">
                        <div class="row">
                            <div class="col-md-12">
                                @if (ViewBag.UserInfo.RightDetail.EnbaleDeleteProject)
                                {
                                    <table class="table table-hover list-table ">
                                        <colgroup>
                                            <col style="width: 40px;">
                                            <col style="width: 200px;">
                                            <col style="width: 120px;">
                                            <col style="width: 200px;">
                                            <col style="width: 190px;">
                                        </colgroup>
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>项目名称</th>
                                                <th>负责人</th>
                                                <th>参与人</th>
                                                <th>项目状态</th>
                                            </tr>
                                        </thead>
                                        <tbody data-bind="foreach: pageList.List">
                                            <tr data-bind="css: EnableViewDetail ? undefined : 'warning'">
                                                <td>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input data-bind="checked: Checked" type="checkbox">
                                                        </label>
                                                    </div>
                                                </td>
                                                <td data-bind="click: $root.edit">
                                                    <span data-bind="text: Name"></span>
                                                </td>
                                                <td data-bind="click: $root.edit">
                                                    <div>
                                                        <span data-bind="text: ManagerNames"></span>
                                                    </div>
                                                </td>
                                                <td data-bind="click: $root.showProjectEditView">
                                                    <div>
                                                        <span data-bind="text: ParticipantNames"></span>
                                                    </div>
                                                </td>
                                                <td data-bind="click: $root.edit">
                                                    <span data-bind="html: DaySpanHtml"></span>
                                                    <br />
                                                    <small data-bind="text: StartTime" class="muted"></small>-
                                                <small data-bind="text: Deadline" class="muted"></small>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                }
                                else
                                {
                                    <table class="table table-hover list-table ">
                                        <colgroup>

                                            <col style="width: 200px;">
                                            <col style="width: 120px;">
                                            <col style="width: 200px;">
                                            <col style="width: 190px;">
                                        </colgroup>
                                        <thead>
                                            <tr>
                                                <th>项目名称</th>
                                                <th>负责人</th>
                                                <th>参与人</th>
                                                <th>项目状态</th>
                                            </tr>
                                        </thead>
                                        <tbody data-bind="foreach: pageList.List">
                                            <tr data-bind="css: EnableViewDetail ? undefined : 'warning'">
                                                <td data-bind="click: $root.edit">
                                                    <h5 data-bind="text: Name"></h5>
                                                </td>

                                                <td data-bind="click: $root.edit">
                                                    <div>
                                                        <span data-bind="text: ManagerNames"></span>
                                                    </div>
                                                </td>
                                                <td data-bind="click: $root.edit">
                                                    <div>
                                                        <span data-bind="text: ParticipantNames"></span>
                                                    </div>
                                                </td>
                                                <td data-bind="click: $root.edit">
                                                    <span data-bind="html: DaySpanHtml"></span>
                                                    <br />
                                                    <small data-bind="text: StartTime" class="muted"></small>-
                                                <small data-bind="text: Deadline" class="muted"></small>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                }

                            </div>
                        </div>
                    </div>
                    <div id="edit" class="col-md-9" style="display: none">
                        <div class="row">
                            <div class="col-md-12">
                                @*                                <ul id="myTab" class="nav nav-tabs">
                                    <li class="active"><a href="#info" data-toggle="tab">任务信息</a></li>
                                    <li class=""><a href="#comment" data-toggle="tab">评论</a></li>
                                </ul>*@
                                <div id="myTabContent" class="tab-content">
                                    <div class="tab-pane fade active in" id="info">
                                        <div data-bind="with: projectEdit" class="row">
                                            @{Html.RenderPartial("EditPartialView");}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="@Url.Content("~/Scripts/models/projectListViewModel.js")" type="text/javascript"></script>

@if (ViewBag.UserInfo.RightDetail.EnableSetProjectUser)
{
    <script type="text/javascript">
        $(function () {
            var users = @Html.ToJsonString(users);
            $("#ManagerNames").userSelectBox({ users: users, bindValue: "ManagerIds" });
            $("#ParticipantNames").userSelectBox({ users: users, bindValue: "ParticipantIds" });
        });
    </script>
}

<script type="text/javascript">

    $(function () {
        $(".system-toolbar .btn-action").tooltip();
        ko.applyBindings(new projectListViewModel(@Html.ToJsonString(currentUser)));
        showPopMessage("Test","<a href='#'>test</a>");
    });

</script>
