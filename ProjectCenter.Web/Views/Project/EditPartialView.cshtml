<div class="col-md-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">基本信息</h3>
        </div>
        <div class="panel-body">
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        项目类型：</label>
                    <div class="col-md-4">
                        <select data-bind="value: Type" class="form-control">
                            <option value=""></option>
                            <option value="0">纵向研究</option>
                            <option value="1">横向研究</option>
                            <option value="2">横向咨询</option>
                            <option value="3">纵向工作</option>
                            <option value="4">中心工作</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        项目名称：</label>
                    <div class="col-md-8">
                        <input data-bind="value: Name" class="form-control" type="text" id="taskName">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        委托单位：</label>
                    <div class="col-md-8">
                        <input data-bind="value: Consignor" class="form-control" id="description" type="text">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        开始时间：</label>
                    <div class="col-md-4">
                        <div class="input-group date form_datetime">
                            <input data-bind="value: StartTime" class="form-control" type="text" value="">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-remove"></span>
                            </span>
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        截止时间：</label>
                    <div class="col-md-4">
                        <div class="input-group date form_datetime">
                            <input data-bind="value: Deadline" class="form-control" type="text" value="">
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-remove"></span>
                            </span>
                            <span class="input-group-addon">
                                <span class="glyphicon glyphicon-calendar"></span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        项目状态：</label>
                    <div class="col-md-4">
                        @{
                            //if (ViewBag.UserInfo.RightLevel == RightLevel.Common)
                            //{
                            <select data-bind="value: Status" class="form-control">
                                <option value="0">发布待审</option>
                                <option value="2">完成待审</option>
                            </select>
                            @*}*@
                            //else
                            //{
                            <select data-bind="value: Status" class="form-control">
                                <option value="0">发布待审</option>
                                <option value="1">发布已审核</option>
                                <option value="2">完成待审</option>
                                <option value="3">完成已审核</option>
                                <option value="4">已取消</option>
                            </select>
                            }
                        }
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        负责人：</label>
                    <div class="col-md-8">
                        <input id="ManagerIds" data-bind="value: ManagerIds" type="hidden" />
                        <input id="ManagerNames" data-bind="value: ManagerNames" class="form-control" type="text" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        参与人员：</label>
                    <div class="col-md-8">
                        <input id="ParticipantIds" data-bind="value: ParticipantIds" type="hidden" />
                        <input id="ParticipantNames" data-bind="value: ParticipantIds" class="form-control" type="text" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        需完成的材料：</label>
                    <div class="col-md-8">
                        <textarea data-bind="value: NeedFinish" class="form-control" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        当前进展：</label>
                    <div class="col-md-8">
                        <textarea data-bind="value: CurrentProgress" class="form-control" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        推进计划：</label>
                    <div class="col-md-8">
                        <textarea data-bind="value: AdvancePlan" class="form-control" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label" for="price">
                        项目金额：</label>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input data-bind="value: Amount" class="form-control easyui-numberbox" data-options="precision:2,groupSeparator:','" type="text" value="">
                            <span class="input-group-addon">元
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label" for="taskName">
                        付款方式：</label>
                    <div class="col-md-4">
                        <input data-bind="value: TypeOfPayment" class="form-control" type="text" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        到款情况：</label>
                    <div class="col-md-4">
                        <select data-bind="value: AmountReceivedStatus" class="form-control">
                            <option value="0">未到款</option>
                            <option value="1">已收前期款</option>
                            <option value="2">已全部到款</option>
                        </select>
                    </div>
                    <div data-bind="if: AmountReceivedStatus() == '1'" class="col-md-3">
                        <div class="input-group">
                            <span class="input-group-addon">已收
                            </span>
                            <input data-bind="value: AmountReceived" class="form-control easyui-numberbox" data-options="precision:2,groupSeparator:','" type="text" value="">
                            <span class="input-group-addon">元
                            </span>
                        </div>
                    </div>
                    <div data-bind="if: AmountReceivedStatus() == '1'" class="col-md-3">
                        <div class="input-group">
                            <span class="input-group-addon">还有
                            </span>
                            <input data-bind="value: AmountRemained" class="form-control" type="text" value="">
                            <span class="input-group-addon">元
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label">
                        开票情况：</label>
                    <div class="col-md-4">
                        <select data-bind="value: InvoiceStatus" class="form-control">
                            <option value="0">未开票</option>
                            <option value="1">已开票</option>
                            <option value="2">已出具到账证明</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="col-md-12">
    <div class="panel panel-default table-panel">
        <div class="panel-heading">
            <ul class="list-unstyled list-inline pull-right list-panel-title">
                <li><a href="#"><span class="glyphicon glyphicon-plus"></span><span class="btn-glyphicon-content">上传附件</span></a></li>
                <li><a href="#"><span class="glyphicon glyphicon-download-alt"></span><span class="btn-glyphicon-content">下载全部</span></a></li>
            </ul>
            <h3 class="panel-title">附件列表</h3>
        </div>
        <table class="table attchment-table">
            <colgroup>
                <col style="width: 450px;">
                <col style="width: 100px;">
                <col style="width: 150px;">
                <col style="width: 40px;">
            </colgroup>
            <tbody data-bind="foreach: Attachments">
                <tr>
                    <td>
                        <a href="#"><span data-bind="text: Name"></span></a>
                    </td>
                    <td>
                        <span data-bind="text: UploadUserName"></span>
                    </td>
                    <td>
                        <span data-bind="text: UploadTime"></span>
                    </td>
                    <td>
                        <a href="#"><span class="glyphicon glyphicon-remove"></span></a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="col-md-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <ul class="list-unstyled list-inline pull-right list-panel-title">
                <li><a data-bind="click: addComment" href="#"><span class="glyphicon glyphicon-comment"></span><span class="btn-glyphicon-content">发表评论</span></a></li>
            </ul>
            <h3 class="panel-title">评论列表</h3>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12">
                    <ul data-bind="foreach: $root.tempDatas" class="list-unstyled comment">
                        <li><span class="comment-user">用户</span> <span class="comment-user">2013-8-20 9:00</span>
                            <ul class="list-unstyled list-inline pull-right">
                                <li><a class="comment-action-link" href="#">删除</a></li>
                            </ul>
                            <hr class="title-content-hr">
                            <p class="comment-content">
                                感谢分享~
                            </p>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 comment-pagination">
                    <ul class="pagination pagination-sm pull-right">
                        <li><a href="#">&laquo;</a></li>
                        <li><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">4</a></li>
                        <li><a href="#">5</a></li>
                        <li><a href="#">&raquo;</a></li>
                    </ul>
                    <div class="pull-right"><span>第 </span><strong><span>1</span>-<span>10</span></strong><span> 条，</span><span>共 </span><strong>120</strong><span> 条评论</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="commentDialog" class="modal fade" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">评论内容</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <textarea data-bind="value: EditCommentContent" class="form-control" rows="8"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <ul class="list-unstyle list-inline pull-right">
                            <li>
                                <button type="button" class="btn btn-primary btn-primary">提交评论</button>

                            </li>
                            <li>
                                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>


<script type="text/ecmascript">

    var projectEditViewModel = function (project) {
        var self = this;
        self.Id = ko.observable(project.Id),
        self.Type = ko.observable(project.Type),
        self.Name = ko.observable(project.Name),
        self.Consignor = ko.observable(project.Consignor),
        self.StartTime = project.StartTime,
        self.Deadline = ko.observable(project.Deadline),
        self.Status = ko.observable(project.Status),
        self.ManagerIds = ko.observable(project.ManagerIds),
        self.ManagerNames = ko.observable(project.ManagerNames)
        self.ParticipantIds = ko.observable(project.ParticipantIds),
        self.ParticipantNames = ko.observable(project.ParticipantNames),
        self.NeedFinish = ko.observable(project.NeedFinish),
        self.CurrentProgress = ko.observable(project.CurrentProgress),
        self.AdvancePlan = ko.observable(project.AdvancePlan),
        self.Amount = ko.observable(project.Amount),
        self.TypeOfPayment = ko.observable(project.TypeOfPayment),
        self.NeedFinish = ko.observable(project.NeedFinish),
        self.AmountReceivedStatus = ko.observable(project.AmountReceivedStatus),
        self.AmountReceived = ko.observable(project.AmountReceived),
        self.AmountRemained = ko.observable(project.AmountRemained),
        self.InvoiceStatus = ko.observable(project.InvoiceStatus),
        self.Attachments = ko.observableArray(project.Attachments)
        self.CommentPageList = ko.observable(new pageListViewModel(project.CommentPageList));


        self.EditCommentContent = ko.observableArray("");

        self.addComment = function () {
            $("#commentDialog").modal("show");
        };
    };

    (function ($) {

        var UserSelectBox = function (element, options) {
            var self = this;
            self.options = options ? $.extend(true, {}, options) : {};
            self.element = $(element);
            self.container = $("<div></div>");
            self.inputContainer = $('<div class="input-group"></div>');
            self.usersPanel = $('<div class="panel panel-default panel-user-select" style="display: none;"></div>');
            self.mouseover = false;
            self.init = function () {
                self.container.insertAfter(self.element);
                self.container.append(self.inputContainer);
                self.container.append(self.usersPanel);

                self.inputContainer.append(self.element);
                if (!options.bindValue
                    || (self.valueElement = $("#" + options.bindValue)).length == 0) {
                    self.valueElement = $('<input type="hidden" />');
                    self.inputContainer.append(self.valueElement);
                }
                self.inputContainer.append($('<span class="input-group-btn"></span>').append(
                    $('<a class="btn btn-default"><span class="glyphicon glyphicon-chevron-down"></span></a>').click(function () {
                        if ($(self.usersPanel).is(":visible")) {
                            self.element.blur();

                            self.hide();
                        } else {
                            self.element.focus();
                            self.show();
                        }
                    })));
                var usersRow = $('<div class="row">').appendTo(self.usersPanel);
                for (var i = 0; i < options.users.length; i++) {
                    usersRow.append('<div class="col-md-3"><div class="checkbox"><label><input value="' + options.users[i].Id + '" type="checkbox"><span>' + options.users[i].Name + '</span></label></div>')
                }
                self.usersPanel.find(":checkbox").click(function () {
                    var ids = [];
                    var names = [];
                    self.usersPanel.find(":checkbox").each(function () {
                        if (this.checked) {
                            var $this = $(this);
                            ids.push($this.val());
                            names.push($this.next().text());
                        }
                    });
                    self.valueElement.val(ids.join(","));
                    self.element.val(names.join(","));
                });
                self.element.keydown(function () {
                    return false;
                });
                self.element.focus(function () {
                    if (!$(self.usersPanel).is(":visible")) {
                        self.show();
                    }
                });
                self.element.blur(function (event) {
                    if (self.mouseover) {
                        self.element.focus();
                    } else {
                        self.hide();
                    }
                    return true;
                });

                self.container.mouseover(function () {
                    self.mouseover = true;
                });
                self.container.mouseout(function () {
                    self.mouseover = false;
                });

            }

            self.show = function () {
                self.clearChecked();

                if (self.valueElement.val()) {
                    var value = self.valueElement.val();
                    if (value) {
                        self.check(value.split(","));
                    }
                }

                $(self.inputContainer).find(".glyphicon").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up");
                self.usersPanel.show();
            };
            self.hide = function () {
                $(self.inputContainer).find(".glyphicon").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down");
                self.usersPanel.hide();
            };

            self.check = function (ids) {
                self.clearChecked();
                if (ids) {
                    self.usersPanel.find("input:checkbox").each(function () {
                        var $this = $(this);
                        for (var i = 0; i < ids.length; i++) {
                            if (ids[i] == $this.val()) {
                                this.checked = true;
                                break;
                            }
                        }
                    });
                }
            };
            self.clearChecked = function () {
                self.usersPanel.find("input:checkbox").each(function () {
                    this.checked = false;
                });
            };
            self.init();
        }

        $.fn.userSelectBox = function (options) {
            this.each(function () {
                new UserSelectBox(this, options);
            });
        }

    })(jQuery);
</script>
